{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrastyle %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}">
<style>
    .import-container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .import-title {
        margin-bottom: 20px;
        font-size: 18px;
        font-weight: bold;
    }
    
    .import-info {
        margin-bottom: 20px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 4px;
    }
    
    .import-form {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .form-row {
        margin-bottom: 15px;
    }
    
    .file-input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .submit-row {
        text-align: right;
        margin-top: 20px;
    }
    
    .json-preview {
        margin-top: 20px;
        padding: 10px;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: monospace;
        white-space: pre-wrap;
        height: 300px;
        overflow-y: auto;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:facetest_facemodel_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; <a href="{% url 'admin:facetest_facemodel_change' face_model.id %}">{{ face_model }}</a>
&rsaquo; {% trans 'Import Face Types' %}
</div>
{% endblock %}

{% block content %}
<div class="import-container">
    <h1 class="import-title">{{ face_model.name }} - 얼굴 유형 일괄 가져오기</h1>
    
    <div class="import-info">
        <p>이 기능은 JSON 파일에서 얼굴 유형 정보를 일괄적으로 가져옵니다.</p>
        <p>파일 형식은 다음과 같아야 합니다:</p>
        <pre>{
  "type_code_1": {
    "name": "유형 이름",
    "description": "유형 설명",
    "characteristics": ["특징1", "특징2", ...],
    "examples": ["예시1", "예시2", ...]
  },
  "type_code_2": { ... }
}</pre>
    </div>
    
    <div class="import-form">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-row">
                <label for="id_json_file">JSON 파일 선택:</label>
                <input type="file" id="id_json_file" name="json_file" class="file-input" accept=".json" onchange="previewJSON(this)">
            </div>
            
            <div id="json-preview-container" style="display: none;">
                <h3>JSON 미리보기:</h3>
                <div id="json-preview" class="json-preview"></div>
            </div>
            
            <div class="submit-row">
                <input type="submit" value="가져오기" class="default">
                <a href="{% url 'admin:facetest_facemodel_change' face_model.id %}" class="button" style="margin-right: 5px;">취소</a>
            </div>
        </form>
    </div>
</div>

<script>
    function previewJSON(input) {
        var preview = document.getElementById('json-preview');
        var container = document.getElementById('json-preview-container');
        
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    // JSON 파싱 및 포맷팅
                    var json = JSON.parse(e.target.result);
                    preview.textContent = JSON.stringify(json, null, 2);
                    container.style.display = 'block';
                    
                    // 유형 수 카운트
                    var typeCount = Object.keys(json).length;
                    preview.textContent += '\n\n총 ' + typeCount + '개의 얼굴 유형이 있습니다.';
                    
                } catch (error) {
                    preview.textContent = '오류: 유효한 JSON 형식이 아닙니다.\n' + error.message;
                    container.style.display = 'block';
                }
            };
            
            reader.readAsText(input.files[0]);
        } else {
            preview.textContent = '';
            container.style.display = 'none';
        }
    }
</script>
{% endblock %}