{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
    body {
        background-color: #f8f9fa;
    }
    
    .share-container {
        background-color: #fff;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 20px 0;
        padding-bottom: 30px;
    }
    
    .share-header {
        background-color: #007bff;
        color: white;
        padding: 15px;
        text-align: center;
    }
    
    .result-image-wrapper {
        padding: 15px;
        text-align: center;
    }
    
    .result-image {
        width: 100%;
        max-width: 300px;
        height: auto;
        border-radius: 10px;
        margin: 0 auto;
    }
    
    .result-content {
        padding: 20px;
        text-align: center;
    }
    
    .result-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 15px;
    }
    
    .result-description {
        font-size: 1.1rem;
        margin-bottom: 20px;
        line-height: 1.6;
    }
    
    .take-test-button {
        display: inline-block;
        background-color: #007bff;
        color: white;
        padding: 12px 30px;
        border-radius: 30px;
        font-weight: bold;
        font-size: 1.1rem;
        text-decoration: none;
        margin-top: 20px;
    }
    
    .take-test-button:hover {
        background-color: #0069d9;
        color: white;
        text-decoration: none;
    }
    
    .social-share-area {
        margin-top: 20px;
        text-align: center;
    }
    
    .share-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 10px;
    }
    
    .share-button {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.2s;
        border: none;
        padding: 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .share-button:hover {
        transform: scale(1.05);
    }
    
    .share-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
    }
</style>

<div class="container mt-4">
    <div class="share-container">
        <div class="share-header">
            <h1 class="h3 mb-0">얼굴상 테스트 결과</h1>
        </div>
        
        <div class="result-content">
            <div class="result-title">
                {% if result.face_type.name %}
                <strong>{{ result.face_type.name }}</strong> 상
                {% else %}
                얼굴상 테스트
                {% endif %}
            </div>
            
            <div class="result-image-wrapper">
                {% if face_type.image %}
                <img src="{{ face_type.image.url }}" alt="{{ face_type.name }}" class="result-image">
                {% endif %}
            </div>
            
            <div class="result-description">
                {{ face_type.description|linebreaks }}
            </div>
            
            {% if face_type.get_characteristics_list %}
            <div class="characteristics-list text-left">
                <h3 class="h5 mb-3">{{ face_type.name }}의 특징</h3>
                {% for characteristic in face_type.get_characteristics_list|slice:":3" %}
                <div class="mb-2">
                    • {{ characteristic }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <div class="social-share-area">
                <h3 class="h5">내 얼굴상도 확인해보세요!</h3>
                <div class="share-buttons">
                    <!-- 페이스북 -->
                    <button class="share-button" id="facebook-share-btn" style="background-color: #1877F2;">
                        <img src="{% static 'images/facebook_icon.png' %}" alt="Facebook" class="share-icon"
                            onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyNSIgY3k9IjI1IiByPSIyNSIgZmlsbD0iIzE4NzdGMiIvPjxwYXRoIGQ9Ik0yNi41MzEgMzUuOTM3VjI1LjE2N0gyOS43OEwzMC4yMTkgMjEuMzVIMjYuNTNWMTguOTQ4QzI2LjUzIDE3LjgyNiAyNi44MzcgMTcuMDY2IDI4LjQ2NiAxNy4wNjZIMzAuMzQ0VjEzLjY2N0MyOS45OSAxMy42MTggMjguNjA5IDEzLjUgMjcuMDQgMTMuNUMyMy43OTIgMTMuNSAyMS41OTQgMTUuNDk1IDIxLjU5NCAxOC41NjNWMjEuMzVIMTguMzQ0VjI1LjE2N0gyMS41OTRWMzUuOTM3SDI2LjUzMVoiIGZpbGw9IndoaXRlIi8+PC9zdmc+';this.onerror='';">
                    </button>
                    
                    <!-- 트위터(X) -->
                    <button class="share-button" id="twitter-share-btn" style="background-color: #000000;">
                        <img src="{% static 'images/twitter_x_icon.png' %}" alt="X" class="share-icon"
                            onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyNSIgY3k9IjI1IiByPSIyNSIgZmlsbD0iIzAwMDAwMCIvPjxwYXRoIGQ9Ik0yOC45MjIgMjFIMzEuOTM0TDI0LjUyNSAyOS4xOTZMMzMgNDBoMjYuMjQ2TDI0LjcyMSAyOS43OTdMMTcgMjFoMi44MjZMMjcuMTA3IDI4LjU5TDI4LjkyMiAyMVpNMzAuMDcgMjIuNDNIMjguNjkyTDIxLjI5NSAzOC4wNTlIMjIuNjdMMzAuMDcgMjIuNDNaIiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==';this.onerror='';">
                    </button>
                    
                    <!-- 카카오톡 -->
                    <button class="share-button" id="kakao-share-btn" style="background-color: #FEE500;">
                        <img src="{% static 'images/kakao_icon.png' %}" alt="KakaoTalk" class="share-icon"
                            onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyNSIgY3k9IjI1IiByPSIyNSIgZmlsbD0iI0ZFRTUwMCIvPjxwYXRoIGQ9Ik0yNS40NjIgMTRDMTkuMzEgMTQgMTQuMzA4IDE3Ljk0NSAxNC4zMDggMjIuODI4QzE0LjMwOCAyNS45NzYgMTYuNTY5IDI4LjcxOSAyMCAzMC4yNjNMMTguOTc0IDMzLjc1OUMyMi43MTIgMzIuMTg3IDI1LjcxOCAzMC45MzYgMjcuNTM4IDI5LjcxM0MzMi41MTMgMjkuNzE1IDM2LjYxNSAyNS4wMDEgMzYuNjE1IDIyLjgyOEMzNi42MTUgMTcuOTQ1IDMxLjYxMiAxNCAyNS40NjIgMTRaTTIwLjc1OCAyMi40ODJIMTkuNDk5VjI1LjI3NEgxOC4wMjRWMTkuODQ4SDE5LjQ5OVYyMS4xMzdIMjAuNzU4VjE5Ljg0OEgyMi4yMzNWMjUuMjc0SDIwLjc1OFYyMi40ODJaTTIzLjA5OSAyMS4wMDhIMjEuNDIzVjE5Ljg0OEgyNi4yOTdWMjEuMDA4SDI0LjYwMlYyNS4yNzRIMjMuMDk5VjIxLjAwOFpNMjkuNDM1IDI1LjI3NEgyNy45NDZMMjYuMzE0IDIzLjM5MlYyNS4yNzRIMjQuODM3VjE5Ljg0OEgyNi4zMTRWMjEuNjE0TDI3LjkxNiAxOS44NDhIMjkuNDA2TDI3LjUwOCAyMS44NEwyOS40MzUgMjUuMjc0Wk0zMi40NzggMjIuODk0QzMyLjQ3OCAyMi4wMDUgMzEuNzkzIDIxLjAzNyAzMC43MDYgMjEuMDM3SDMwLjA5M1YyNC43MzdIMzAuNjIzQzMxLjY0NCAyNC43MzcgMzIuNDc4IDIzLjgzOSAzMi40NzggMjIuODk0VjIyLjg5NFpNMzIuNDc4IDIyLjg5NEMzMi40NzggMjAuODggMzEuMDk4IDE5Ljg0OCAyOS44ODggMTkuODQ4SDI4LjYyVjI1LjI3NFYyNS4yNzRIMjkuODg4QzMxLjA5OCAyNS4yNzQgMzIuNDc4IDI0LjkwOCAzMi40NzggMjIuODk0VjIyLjg5NFoiIGZpbGw9ImJsYWNrIi8+PC9zdmc+';this.onerror='';">
                    </button>
                </div>
            </div>
            
            <a href="{% url 'facetest:index' %}" class="take-test-button">
                <i class="bi bi-camera"></i> 내 얼굴상도 테스트하기
            </a>
        </div>
    </div>
</div>

<!-- 카카오톡 SDK -->
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" 
integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4" 
crossorigin="anonymous"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 공유할 URL 설정
    const shareUrl = window.location.href;
    const testUrl = '{% url "facetest:index" %}';
    
    const title = "내 얼굴은 {{ face_type.name }} 상이래요!";
    const description = "{{ face_type.description|truncatechars:50|escapejs }}";
    
    // 페이스북 공유
    document.getElementById('facebook-share-btn').addEventListener('click', function() {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, 'facebook', 'width=600, height=700, resizable=no');
    });

    // 트위터(X) 공유
    document.getElementById('twitter-share-btn').addEventListener('click', function() {
        window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(title)}`, 'twitter', 'width=600, height=700, resizable=no');
    });
    
    // 카카오톡 공유 초기화
    try {
        Kakao.init('{{ kakao_api_key }}'); 
        console.log('Kakao init success:', Kakao.isInitialized());

        // 카카오 버튼
        document.getElementById('kakao-share-btn').addEventListener('click', function(e) {
            e.preventDefault();
            
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: title,
                    description: description,
                    imageUrl: '{{ request.scheme }}://{{ request.get_host }}{% if face_type.image %}{{ face_type.image.url }}{% endif %}',
                    link: {
                        mobileWebUrl: shareUrl,
                        webUrl: shareUrl
                    }
                },
                buttons: [
                    {
                        title: '결과 확인하기',
                        link: {
                            mobileWebUrl: shareUrl,
                            webUrl: shareUrl
                        }
                    },
                    {
                        title: '테스트 하기',
                        link: {
                            mobileWebUrl: testUrl,
                            webUrl: testUrl
                        }
                    }
                ]
            });
        });
        
    } catch (e) {
        console.error('카카오톡 공유 초기화 실패:', e);
        document.getElementById('kakao-share-btn').addEventListener('click', function(e) {
            alert('카카오톡 공유 기능을 초기화하는데 실패했습니다');
        });
    }
});
</script>
{% endblock %}