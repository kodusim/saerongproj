{% load static %}
<div id="question-container">
    <!-- 진행 바 -->
    <div class="progress-container">
        <div class="progress-track">
            <div class="progress-bar" style="width: {{ progress }}%;"></div>
        </div>
        {% if test.gauge_character %}
            <img src="{{ test.gauge_character.url }}" class="progress-character" style="left: calc({{ progress }}% - 15px);">
        {% else %}
            <img src="{% static 'images/default-character.png' %}" class="progress-character" style="left: calc({{ progress }}% - 15px);">
        {% endif %}
    </div>
    
    <!-- 질문 내용 - 여기서 바로 이미지나 텍스트 시작 -->
    {% if question.image %}
    <div class="question-image-container">
        <img src="{{ question.image.url }}" alt="{{ question.text }}" class="question-image">
    </div>
    {% else %}
    <div class="question-text">
        {{ question.text }}
    </div>
    {% endif %}
    
    <!-- 선택지 코드는 그대로 유지 -->
    <form id="question-form" method="post" hx-post="{% url 'psychotest:answer_question' test.id question.id %}" 
            hx-target="#question-container" hx-swap="outerHTML">
        {% csrf_token %}
        <div class="options-container options-{{ question.options.all|length }}">
            {% for option in question.options.all %}
            <button type="button" class="cloud-button" 
                    onclick="selectOption('{{ option.id }}')">
                {{ option.text }}
            </button>
            {% endfor %}
        </div>
        <input type="hidden" name="answer" id="selected-option">
        <input type="hidden" name="current_index" value="{{ current_index }}">
    </form>
</div>

<script>
    function selectOption(optionId) {
        document.getElementById('selected-option').value = optionId;
        // 선택된 버튼에 시각적 표시 추가
        const buttons = document.querySelectorAll('.cloud-button');
        buttons.forEach(btn => {
            btn.disabled = true; // 중복 클릭 방지
            if(btn.onclick.toString().includes(optionId)) {
                btn.style.backgroundColor = '#e6f7ff';
                btn.style.transform = 'translateY(-1px)';
            }
        });
        
        // 폼 제출
        var form = document.getElementById('question-form');
        htmx.trigger(form, 'submit');
    }
    
    // 게이지 컨테이너 위치 수정 (선택적)
    document.addEventListener('DOMContentLoaded', function() {
        // 모바일 브라우저 감지
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isMobile) {
            // Samsung 브라우저 특정 처리 (필요한 경우)
            if (navigator.userAgent.match(/SamsungBrowser/i)) {
                const container = document.querySelector('.question-container');
                if (container) {
                    container.style.paddingTop = '60px';
                }
            }
        }
    });
</script>