{% load static %}
<div id="question-container">
    <!-- 진행 바 - 이미지 위에 위치 -->
    <div class="progress-container">
        <div class="progress-track">
            <div class="progress-bar" style="width: {{ progress }}%;"></div>
        </div>
        {% if test.gauge_character %}
            <img src="{{ test.gauge_character.url }}" class="progress-character" style="left: calc({{ progress }}% - 15px);">
        {% else %}
            <img src="{% static 'images/default-character.png' %}" class="progress-character" style="left: calc({{ progress }}% - 15px);">
        {% endif %}
    </div>
    
    <!-- 질문 내용 - 상단 타이틀 없이 이미지만 표시 -->
    <div class="question-content">
        {% if question.image %}
        <div class="question-image-container">
            <img src="{{ question.image.url }}" alt="{{ question.text }}" class="question-image">
        </div>
        {% else %}
        <div class="question-text">
            {{ question.text }}
        </div>
        {% endif %}
        
        <!-- 선택지 -->
        <form id="question-form" method="post" hx-post="{% url 'psychotest:answer_question' test.id question.id %}" 
                hx-target="#question-container" hx-swap="outerHTML">
            {% csrf_token %}
            <div class="options-container options-{{ question.options.all|length }}">
                {% for option in question.options.all %}
                <button type="button" class="option-button" 
                        onclick="selectOption('{{ option.id }}')">
                    {{ option.text }}
                </button>
                {% endfor %}
            </div>
            <input type="hidden" name="answer" id="selected-option">
            <input type="hidden" name="current_index" value="{{ current_index }}">
        </form>
    </div>
</div>

<script>
    function selectOption(optionId) {
        document.getElementById('selected-option').value = optionId;
        // 수동으로 form을 제출합니다
        var form = document.getElementById('question-form');
        // HTMX에게 폼을 제출하도록 지시합니다
        htmx.trigger(form, 'submit');
    }
</script>