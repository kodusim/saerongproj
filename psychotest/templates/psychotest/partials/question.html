{% load static %}
<!-- 게이지 바 -->
<div class="progress-container">
    <div class="progress-track">
        <div class="progress-bar" style="width: {{ progress }}%;"></div>
    </div>
    {% if test.gauge_character %}
        <img src="{{ test.gauge_character.url }}" class="progress-character" style="left: min(calc({{ progress }}% - 20px), calc(100% - 40px));">
    {% else %}
        <img src="{% static 'images/default-character.png' %}" class="progress-character" style="left: min(calc({{ progress }}% - 20px), calc(100% - 40px));">
    {% endif %}
</div>

<!-- 질문 이미지 -->
{% if question.image %}
<div class="question-image-container">
    <img src="{{ question.image.url }}" alt="{{ question.text }}" class="question-image">
</div>
{% else %}
<div class="question-text">
    {{ question.text }}
</div>
{% endif %}

<!-- 선택지 -->
<form id="question-form" method="post" hx-post="{% url 'psychotest:answer_question' test.id question.id %}" 
        hx-target="#question-container" hx-swap="outerHTML">
    {% csrf_token %}
    <div class="options-container">
        {% for option in question.options.all %}
        <button type="button" class="cloud-button" 
                onclick="selectOption('{{ option.id }}')">
            {{ option.text }}
        </button>
        {% endfor %}
    </div>
    <input type="hidden" name="answer" id="selected-option">
    <input type="hidden" name="current_index" value="{{ current_index }}">
</form>

<script>
    function selectOption(optionId) {
        document.getElementById('selected-option').value = optionId;
        const buttons = document.querySelectorAll('.cloud-button');
        buttons.forEach(btn => {
            btn.disabled = true; // 중복 클릭 방지
        });
        
        // 폼 제출
        var form = document.getElementById('question-form');
        htmx.trigger(form, 'submit');
    }
</script>